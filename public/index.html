<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lazy Susan PRO</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Georgia,serif;background:#0a0a0a;color:#e0e0e0;min-height:100vh;padding:20px}
    .container{max-width:900px;margin:0 auto}
    header{text-align:center;margin-bottom:40px;padding:20px 0;border-bottom:1px solid #1B4D3E}
    h1{font-size:2.5rem;color:#1B4D3E;margin-bottom:8px}
    .subtitle{color:#8B6914;font-style:italic}
    .lang-selector{display:flex;justify-content:center;gap:10px;margin:20px 0}
    .lang-btn{padding:8px 16px;border:2px solid #333;background:transparent;color:#e0e0e0;border-radius:6px;cursor:pointer;font-size:1rem}
    .lang-btn:hover{border-color:#1B4D3E}
    .lang-btn.active{border-color:#1B4D3E;background:#1B4D3E;color:white}
    .input-section{margin-bottom:30px}
    textarea{width:100%;padding:16px;font-family:Georgia,serif;font-size:1.1rem;background:#111;border:2px solid #1B4D3E;color:#e0e0e0;border-radius:8px;resize:vertical;min-height:100px}
    textarea:focus{outline:none;border-color:#8B6914}
    button.submit{width:100%;padding:16px;margin-top:12px;font-family:Arial,sans-serif;font-size:1.1rem;font-weight:bold;background:#1B4D3E;color:white;border:none;border-radius:8px;cursor:pointer}
    button.submit:hover{background:#2a6b54}
    button.submit:disabled{background:#333;cursor:not-allowed}
    .loading{text-align:center;padding:40px;color:#8B6914}
    .spinner{display:inline-block;width:40px;height:40px;border:3px solid #333;border-top-color:#1B4D3E;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .results{display:none}
    .synthesis{background:#111;border:2px solid #1B4D3E;border-radius:8px;padding:24px;margin-bottom:30px}
    .synthesis>h2{color:#1B4D3E;margin-bottom:16px;font-size:1.3rem}
    .synthesis-content{line-height:1.8}
    .synthesis-content h2{color:#1B4D3E;font-size:1.3rem;margin:20px 0 12px 0;border-bottom:1px solid #333;padding-bottom:6px}
    .synthesis-content h3{color:#8B6914;font-size:1.15rem;margin:16px 0 10px 0}
    .synthesis-content h4{color:#ccc;font-size:1.05rem;margin:12px 0 8px 0}
    .agents-toggle{background:transparent;border:1px solid #333;color:#8B6914;font-size:0.9rem;padding:10px 16px;margin-bottom:16px;cursor:pointer;border-radius:6px}
    .agents-toggle:hover{background:#111}
    .agents{display:none}
    .agents.visible{display:block}
    .agent{background:#0d0d0d;border:1px solid #222;border-radius:8px;padding:20px;margin-bottom:16px}
    .agent-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .agent-name{color:#1B4D3E;font-weight:bold}
    .agent-model{color:#555;font-size:0.8rem;font-family:monospace}
    .agent-role{color:#8B6914;font-style:italic;font-size:0.9rem;margin-bottom:12px}
    .agent-response{line-height:1.7}
    .agent-response h2{color:#1B4D3E;font-size:1.2rem;margin:16px 0 10px 0}
    .agent-response h3{color:#8B6914;font-size:1.1rem;margin:12px 0 8px 0}
    .agent-response h4{color:#ccc;font-size:1rem;margin:10px 0 6px 0}
    .agent-error{color:#c0392b}
    .timestamp{text-align:center;color:#444;font-size:0.85rem;margin-top:30px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ¯ Lazy Susan</h1>
      <p class="subtitle">Multi-model AI orchestrator PRO</p>
    </header>
    <div class="lang-selector">
      <button class="lang-btn active" data-lang="en">ğŸ‡¬ğŸ‡§ EN</button>
      <button class="lang-btn" data-lang="ru">ğŸ‡·ğŸ‡º RU</button>
      <button class="lang-btn" data-lang="et">ğŸ‡ªğŸ‡ª ET</button>
    </div>
    <div class="input-section">
      <textarea id="question" placeholder="Enter your question..."></textarea>
      <button class="submit" id="submit" onclick="ask()">Ask</button>
    </div>
    <div class="loading" id="loading" style="display:none">
      <div class="spinner"></div>
      <p style="margin-top:16px" id="loadingText">Agents thinking...</p>
    </div>
    <div class="results" id="results">
      <div class="synthesis">
        <h2 id="synthesisTitle">ğŸ¼ Conductor's Synthesis</h2>
        <div class="synthesis-content" id="synthesis"></div>
      </div>
      <button class="agents-toggle" onclick="toggleAgents()" id="agentsToggle">â–¶ Show agent responses</button>
      <div class="agents" id="agents"></div>
      <p class="timestamp" id="timestamp"></p>
    </div>
  </div>
  <script>
    let currentLang='en';
    const UI={
      en:{placeholder:'Enter your question...',askBtn:'Ask',loading:'Elite agents analyzing...',synthesisTitle:'ğŸ¼ Conductor\'s Synthesis',showAgents:'â–¶ Show agent responses',hideAgents:'â–¼ Hide agent responses',generated:'Generated'},
      ru:{placeholder:'Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ...',askBtn:'Ğ¡Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ',loading:'Ğ­Ğ»Ğ¸Ñ‚Ğ½Ñ‹Ğµ Ğ°Ğ³ĞµĞ½Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‚...',synthesisTitle:'ğŸ¼ Ğ¡Ğ¸Ğ½Ñ‚ĞµĞ· Ğ´Ğ¸Ñ€Ğ¸Ğ¶Ñ‘Ñ€Ğ°',showAgents:'â–¶ ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²',hideAgents:'â–¼ Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ğ°Ğ³ĞµĞ½Ñ‚Ğ¾Ğ²',generated:'Ğ¡Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾'},
      et:{placeholder:'Sisesta oma kÃ¼simus...',askBtn:'KÃ¼si',loading:'Eliit-agendid analÃ¼Ã¼sivad...',synthesisTitle:'ğŸ¼ Dirigendi sÃ¼ntees',showAgents:'â–¶ NÃ¤ita agentide vastuseid',hideAgents:'â–¼ Peida agentide vastused',generated:'Genereeritud'}
    };
    function updateUI(){
      const t=UI[currentLang];
      document.getElementById('question').placeholder=t.placeholder;
      document.getElementById('submit').textContent=t.askBtn;
      document.getElementById('loadingText').textContent=t.loading;
      document.getElementById('synthesisTitle').textContent=t.synthesisTitle;
      const toggle=document.getElementById('agentsToggle');
      toggle.textContent=document.getElementById('agents').classList.contains('visible')?t.hideAgents:t.showAgents;
    }
    document.querySelectorAll('.lang-btn').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.lang-btn').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        currentLang=btn.dataset.lang;
        updateUI();
      });
    });
    function renderMarkdown(text){
      return text
        .replace(/^####\s+(.+)$/gm,'<h4>$1</h4>')
        .replace(/^###\s+(.+)$/gm,'<h3>$1</h3>')
        .replace(/^##\s+(.+)$/gm,'<h2>$1</h2>')
        .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
        .replace(/\*(.+?)\*/g,'<em>$1</em>')
        .replace(/\n/g,'<br>');
    }
    async function ask(){
      const question=document.getElementById('question').value.trim();
      if(!question)return;
      const submitBtn=document.getElementById('submit');
      const loading=document.getElementById('loading');
      const results=document.getElementById('results');
      submitBtn.disabled=true;
      loading.style.display='block';
      results.style.display='none';
      try{
        const response=await fetch('/api/ask',{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({question,lang:currentLang})
        });
        const data=await response.json();
        if(data.error){alert('Error: '+data.error);return;}
        document.getElementById('synthesis').innerHTML=renderMarkdown(data.synthesis);
        document.getElementById('agents').innerHTML=data.agents.map(a=>`
          <div class="agent">
            <div class="agent-header">
              <span class="agent-name">${a.agent}</span>
              <span class="agent-model">${a.model||''}</span>
            </div>
            <div class="agent-role">${a.role||''}</div>
            <div class="agent-response ${a.error?'agent-error':''}">${a.error?'âŒ '+a.error:renderMarkdown(a.response)}</div>
          </div>
        `).join('');
        document.getElementById('timestamp').textContent=UI[currentLang].generated+': '+new Date(data.timestamp).toLocaleString();
        results.style.display='block';
      }catch(error){
        alert('Network error: '+error.message);
      }finally{
        submitBtn.disabled=false;
        loading.style.display='none';
      }
    }
    function toggleAgents(){
      const agents=document.getElementById('agents');
      const btn=document.getElementById('agentsToggle');
      const t=UI[currentLang];
      if(agents.classList.contains('visible')){
        agents.classList.remove('visible');
        btn.textContent=t.showAgents;
      }else{
        agents.classList.add('visible');
        btn.textContent=t.hideAgents;
      }
    }
    document.getElementById('question').addEventListener('keydown',(e)=>{
      if(e.key==='Enter'&&e.ctrlKey){ask();}
    });
  </script>
</body>
</html>
